groups:
- name: alerts
  rules:

  - alert: JobDown
    expr: up == 0
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Job {{ $labels.down }} unreachable"
      description: "Job {{ $labels.job }} on {{ $labels.instance }} has been down for more than 5 minutes."

  - alert: FileSystemUsageHigh
    expr: node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes < 0.2
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Root filesystem too full"
      description: "Root filesystem on {{ $labels.instance }} is more than 80% full."

  - alert: UnitFailed
    expr: node_systemd_unit_state{state="failed"} == 1
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "systemd unit {{ $labels.name }} failed"
      description: "The systemd unit {{ $labels.name }} on {{ $labels.instance }} has been down for more than 5 minutes."

  - alert: TorUnreachable
    expr: tor_network_liveness == 0
    for: 1h
    labels:
      severity: ticket
    annotations:
      summary: "tor network unreachable"
      description: "The Tor node on {{ $labels.instance }} has been unreachable for more than 1h."

  - alert: ProbeFailed
    expr: probe_success == 0
    for: 5m
    labels:
      severity: page
    annotations:
      summary: "Probe {{ $labels.job }} on {{ $labels.instance }} failed"
      description: "Probe {{ $labels.job }} on {{ $labels.instance }} failed 3 times in a row."
